<!DOCTYPE html>
<!--
  ██╗    ██╗    ██╗ █████╗ ███████╗    ███████╗██╗  ██╗██████╗ ███████╗ ██████╗████████╗██╗███╗   ██╗ ██████╗     ██╗   ██╗ ██████╗ ██╗   ██╗    ██╗
  ██║    ██║    ██║██╔══██╗██╔════╝    ██╔════╝╚██╗██╔╝██╔══██╗██╔════╝██╔════╝╚══██╔══╝██║████╗  ██║██╔════╝     ╚██╗ ██╔╝██╔═══██╗██║   ██║    ██║
  ██║    ██║ █╗ ██║███████║███████╗    █████╗   ╚███╔╝ ██████╔╝█████╗  ██║        ██║   ██║██╔██╗ ██║██║  ███╗     ╚████╔╝ ██║   ██║██║   ██║    ██║
  ██║    ██║███╗██║██╔══██║╚════██║    ██╔══╝   ██╔██╗ ██╔═══╝ ██╔══╝  ██║        ██║   ██║██║╚██╗██║██║   ██║      ╚██╔╝  ██║   ██║██║   ██║    ╚═╝
  ██║    ╚███╔███╔╝██║  ██║███████║    ███████╗██╔╝ ██╗██║     ███████╗╚██████╗   ██║   ██║██║ ╚████║╚██████╔╝       ██║   ╚██████╔╝╚██████╔╝    ██╗
  ╚═╝     ╚══╝╚══╝ ╚═╝  ╚═╝╚══════╝    ╚══════╝╚═╝  ╚═╝╚═╝     ╚══════╝ ╚═════╝   ╚═╝   ╚═╝╚═╝  ╚═══╝ ╚═════╝        ╚═╝    ╚═════╝  ╚═════╝     ╚═╝
 -->
<html lang="en-us">
<head>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-P8JYGFF61H"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-P8JYGFF61H');
  </script>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="theme" content="hugo-academic"/>
  <meta name="generator" content="Hugo 0.49"/>
  <meta name="author" content="Aman Shrivastava"/>
  <meta name="description" content="">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha512-6MXa8B6uaO18Hid6blRMetEIoPqHf7Ux1tnyIQdpt9qI5OACx7C+O3IVTr98vwGnlcg0LOLa02i9Y1HpVhlfiw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.0/css/academicons.min.css" integrity="sha512-GGGNUPDhnG8LEAEDsjqYIQns+Gu8RBs4j5XGlxl7UfRaZBhCCm5jenJkeJL8uPuOXGqgl8/H1gjlWQDRjd3cUQ==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha512-SfTiTlX6kk+qitfevl/7LibUOeJWlt9rbyDn92a1DqWOw9vWG2MFoays0sgObmWazO5BQPiFucnnEAjpAB+/Sw==" crossorigin="anonymous">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather%7CRoboto+Mono">
  <link rel="stylesheet" href="/css/hugo-academic.css">
  <link rel="stylesheet" href="/css/highlight.min.css">
  <link rel="icon" type="image/jpeg" href="../img/ticon.jpg">
  <link rel="apple-touch-icon" type="image/png" href="../img/apple-touch-icon.jpg">
  <link rel="canonical" href="https://imashrivastava.github.io/stations">

  <title>Stations | Animal Welfare Platform</title>
  <style>
    h2 {
      color: #000000;
      border-bottom: 1px solid #000000;
      padding-bottom: 0.5rem;
      margin-top: 4rem;
    }
    .pub-card {
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(2px);
      -webkit-backdrop-filter: blur(2px);
      border-radius: 12px;
      padding: 1rem 1rem 0.5rem;
      margin-bottom: 12px;
      box-shadow: 0 2px 24px rgba(0,0,0,0.6);
      cursor: pointer;
      transition: all 0.25s ease-in-out;
      position: relative;
      display: flex;
      flex-wrap: wrap;
      align-items: flex-start;
      gap: 12px;
      border: 1px solid rgba(255,255,255,0.05);
      overflow: hidden;
    }
    .pub-card:hover {
      background: rgba(0, 0, 0, 0.92);
      /*box-shadow: 0 4px 28px rgba(0,0,0,0.75);*/
    }
    .pub-title {
      color: #ffffff;
      font-size:1.05rem;
      margin:0;
    }
    .pub-authors {
      font-style:italic;
      color:#cccccc;
      margin:0.25rem 0 0;
    }
    .pub-venue {
      font-weight:600;
      color:#00c3ff;
    }
    .pub-year {
      position:absolute;
      right:20px;
      top:1rem;
      color:#00c3ff;
      font-weight:bold;
    }
    .pub-links {
      margin-top:0.5rem;
    }
    .pub-links a {
      color:#00c3ff;
      margin-right:0.75rem;
      text-decoration:none;
    }
    .pub-abstract {
      margin-top:0.75rem;
      font-size:0.95rem;
      line-height:1.5rem;
      color:#d0d0d0;
    }
    .pub-card.expanded .pub-abstract {
      display:block;
    }

    /* Search Bar */
    .toolbar {
      display: flex;
      justify-content: center;   /* centers toolbar in page */
      align-items: center;       /* vertically align button + input */
      margin: 1.2rem 0 0.8rem 0;
      gap: 0;                    /* remove spacing between input and button */
    }

    .search-box {
      padding: 14px 22px;
      font-size: 17px;
      border: 2px solid black;
      border-radius: 35px 0 0 35px; /* left pill corners rounded, right square */
      outline: none;
      width: 550px;              /* keeps original size */
    }
    .search-btn {
      padding: 14px 28px;
      font-size: 17px;
      background: #0d6efd;
      color: white;
      border: 2px solid black;
      border-left: none;         /* merge with search bar */
      border-radius: 0 35px 35px 0; /* right pill corners rounded, left square */
      cursor: pointer;
      font-weight: 600;
      width: auto;
      flex-shrink: 0;
    }

    .search-btn:hover {
      background: #0b5ed7;
    }

    .search-btn:hover {
      background: #0b5ed7;
    }

    /* Filters */
    .filter-container {
      display: flex;
      justify-content: center;
      gap: 8px;                    /* SMALLER GAP */
      margin-bottom: 1.6rem;
    }

    .filter-select {
      padding: 8px 14px;
      font-size: 15px;
      border: 2px solid black;
      border-radius: 10px;
      background: white;
    }

    #consoleOutput {
      background: #000 !important;
      color: #00ff00;
      font-family: "Roboto Mono", monospace;
      font-size: 0.95rem;

      width: 95%;
      margin: 1rem auto 1.2rem auto;
      padding: 14px;

      border-radius: 8px;
      border: none !important;

      min-height: 150px;          /* NEW: minimum console height */
      max-height: 350px;          /* optional: console scrolls beyond this */
      overflow-y: auto;

      box-shadow: none !important;
    }

    #consoleOutput,
    #consoleOutput * {
      background: #000 !important;
      border: none !important;
      box-shadow: none !important;
    }

    /* Card Grid — 4 cards per row */
    .card-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr); /* 4 columns */
      gap: 20px; /* space between cards */
      padding: 0;
      align-items: stretch; /* all cards same height */
    }

    /* Cards */
    .card {
      background: #fff;
      border: 2px solid black;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.15);
      display: flex;
      flex-direction: column;
      height: auto; /* auto height based on content */
    }

    /* Card Body */
    .card-body {
      padding: 12px;
      flex: 1; /* take remaining space */
      overflow: auto; /* scroll if content overflows */
    }

    /* Card Title & Text */
    .card-title {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 8px;
      word-wrap: break-word;
      overflow-wrap: anywhere;
    }

    .card-text {
      font-size: 13px;
      line-height: 1.5;
      word-wrap: break-word;
      overflow-wrap: anywhere;
    }

    /* Responsive — 2 cards per row on tablets, 1 on mobile */
    @media(max-width:1024px) {
      .card-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media(max-width:768px) {
      .card-grid {
        grid-template-columns: 1fr;
      }
    }


    #wikitext {
      margin-top:5px;
      line-height:1.33em;
      font-family: 'Merriweather', serif;
      color: #000000;
      font-size: 1rem;
    }
  </style>

</head>
<body id="top" data-spy="scroll" data-target="#navbar-main" data-offset="71">
<nav class="navbar navbar-default navbar-fixed-top" id="navbar-main">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://imashrivastava.github.io/dbms">Animal Welfare Platform</a>
    </div>

    <div class="collapse navbar-collapse">
      <ul class="nav navbar-nav navbar-right">
        <li class="nav-item"><a href="https://imashrivastava.github.io/animals"><span>Animals</span></a></li>
        <li class="nav-item"><a href="https://imashrivastava.github.io/stations"><span>Stations</span></a></li>
        <li class="nav-item"><a href="https://imashrivastava.github.io/team"><span>Team</span></a></li>
        <li class="nav-item"><a href="https://imashrivastava.github.io/doctors"><span>Doctors</span></a></li>
        <li class="nav-item"><a href="https://imashrivastava.github.io/daq"><span>DAQ</span></a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="container">

  <div class="toolbar">
    <input type="text" id="searchInput" placeholder="Search Station ID, Pin Code, Manager, Staff " class="search-box">
    <button id="searchBtn" class="search-btn">Search</button>
  </div>

  <div class="filter-container">
    <select id="filterCity" class="filter-select">
      <option value="">City</option>
      <option value="Delhi">Delhi</option>
      <option value="Mumbai">Mumbai</option>
      <option value="Pune">Pune</option>
      <option value="Bangalore">Bangalore</option>
      <option value="Chennai">Chennai</option>
    </select>

    <select id="filterState" class="filter-select">
      <option value="">State</option>
      <option value="Delhi">Delhi</option>
      <option value="Maharashtra">Maharashtra</option>
      <option value="Karnataka">Karnataka</option>
      <option value="Tamil Nadu">Tamil Nadu</option>
    </select>

    <select id="filterSubsystem" class="filter-select">
      <option value="">Subsystem</option>
      <option value="Processing Unit">Processing Unit</option>
      <option value="Visual Processor">Visual Processor</option>
      <option value="Power Management">Power Management</option>
      <option value="Food Dispenser">Food Dispenser</option>
      <option value="Water Dispenser">Water Dispenser</option>
      <option value="Purification System">Purification System</option>
      <option value="Climate Indicator">Climate Indicator</option>
    </select>

    <select id="filterActivity" class="filter-select">
      <option value="">Status</option>
    </select>

    <select id="filterQty" class="filter-select">
      <option value="">Quantity</option>
      <option value="LOW">LOW</option>
      <option value="ADEQUATE">ADEQUATE</option>
      <option value="SUFFICIENT">SUFFICIENT</option>
    </select>
  </div>

  <div id="consoleOutput"></div>

  <div id="cardGrid" class="card-grid">
  </div>

</div>



<footer class="site-footer">
  <div class="container">
    <p class="powered-by">
      &copy;  <script>document.write(new Date().getFullYear());</script> Aman Shrivastava
      <span class="pull-right" aria-hidden="true">
           <a href="#" id="back_to_top">
             <span class="button_icon">
               <i class="fa fa-chevron-up fa-2x"></i>
             </span>
           </a>
         </span>
    </p>
  </div>
</footer>

<script>
  let allStations = [];
  let aggregationData = null;

  const API_BASE = "https://cpscdbms-f50436d7d43e.herokuapp.com/api";

  // Map subsystem types to possible statuses
  const subsystemActivities = {
    "Processing Unit": ["ACTIVE", "DATA UPLINK", "DATA DOWNLINK", "UNACTIVE"],
    "Visual Processor": ["LIVE", "PAUSED"],
    "Power Management": ["ON", "OFF", "SWITCHING"],
    "Food Dispenser": ["ACTIVE", "PAUSED"],
    "Water Dispenser": ["ACTIVE", "PAUSED"],
    "Purification System": ["PURIFIED", "AWAITING"],
    "Climate Indicator": ["SUNNY", "RAIN", "CLEAR"]
  };

  function getQtyLevel(sys) {
    if (!["Food Dispenser", "Water Dispenser", "Purification System"].includes(sys.sysType))
      return null;
    const q = sys.resourceQty;
    if (q < 2) return "LOW";
    if (q >= 2 && q < 3) return "ADEQUATE";
    return "SUFFICIENT";
  }

  function logToConsole(msg) {
    const c = document.getElementById("consoleOutput");
    c.innerHTML += msg + "<br>";
    c.scrollTop = c.scrollHeight;
  }

  async function loadStations() {
    const url = `${API_BASE}/stations`;
    logToConsole(`> FETCH: ${url}`);

    try {
      const res = await fetch(url);
      allStations = await res.json();
      logToConsole(`> LOADED: ${allStations.length} stations`);
      applyFilters();
    } catch (err) {
      logToConsole(`> ERROR: ${err.message}`);
    }
  }

  async function loadAggregations() {
    const url = `${API_BASE}/stations/aggregations`;
    logToConsole(`> FETCH (AGG): ${url}`);

    try {
      const res = await fetch(url);
      aggregationData = await res.json();

      logToConsole(`> AGGREGATIONS LOADED`);
      logToConsole(`> Total Stations: ${aggregationData.total_stations}`);

      logToConsole(
              `> Cities: ${aggregationData.stations_per_city
                      .map(c => `${c.city}(${c.count})`).join(", ")}`
      );

      logToConsole(
              `> States: ${aggregationData.stations_per_state
                      .map(s => `${s.state}(${s.count})`).join(", ")}`
      );

      logToConsole(`> Avg Power: ${aggregationData.average_power}`);

      logToConsole(
              `> Subsystems by Type: ${aggregationData.subsystems_by_type
                      .map(s => `${s.sysType}(${s.count})`).join(", ")}`
      );

      logToConsole(
              `> Resource Levels: ${aggregationData.resource_levels
                      .map(r => `${r.level}(${r.count})`).join(", ")}`
      );

    } catch (err) {
      logToConsole(`> AGG ERROR: ${err.message}`);
    }
  }

  async function loadTopAvgResource() {
    const url = `${API_BASE}/stations/top-average-resource`;
    logToConsole(`> FETCH (TOP AVG RESOURCE): ${url}`);

    try {
      const res = await fetch(url);
      const data = await res.json();

      logToConsole("> NESTED AGGREGATION RESULT");
      logToConsole(`> Station With Highest Avg ResourceQty: ${data.stationid}`);
      logToConsole(`> Average Resource Qty: ${data.avg_qty}`);

      return data;
    } catch (err) {
      logToConsole(`> NESTED AGG ERROR: ${err.message}`);
    }
  }

  function displayStations(stations) {
    const container = document.getElementById("cardGrid");
    container.innerHTML = "";

    stations.forEach(st => {
      const subsystems = (st.subsystems || []).map(s => {
        let qty = "";
        if (["Food Dispenser", "Water Dispenser", "Purification System"].includes(s.sysType)) {
          qty = `, Qty: ${s.resourceQty} ${s.sysType === "Food Dispenser" ? "Kg" : "Litre"}`;
        }
        return `${s.sysType}: ${s.currentActivity}${qty}`;
      }).join("<br>") || "N/A";

      const managerStr = st.manager ? `${st.manager.F_name} ${st.manager.L_name}` : "N/A";
      const staffStr = (st.staff || [])
              .map(s => `${s.F_name} ${s.L_name} → ${s.sysType}`)
              .join("<br>") || "N/A";

      const card = document.createElement("div");
      card.className = "card";
      card.innerHTML = `
        <div class="card-body">
          <h4 class="card-title">${st.stationID}</h4>
          <p class="card-text">Power: ${st.powerLevel} Volts</p>
          <p class="card-text">Lat: ${st.latitude} Long: ${st.longitude}<br>
            Location: ${st.address}<br>
            City: ${st.city}<br>
            State: ${st.state}<br>
            Pincode: ${st.pincode}</p>

          <p class="card-text">Subsystems:<br>${subsystems}</p>
          <p class="card-text">Manager: ${managerStr}<br>Staff:<br>${staffStr}</p>
        </div>
      `;
      container.appendChild(card);
    });

    logToConsole(`> DISPLAY: Showing ${stations.length} stations`);
  }

  function applyFilters(searchTerm = "") {
    const city = document.getElementById("filterCity").value;
    const state = document.getElementById("filterState").value;
    const subsystem = document.getElementById("filterSubsystem").value;
    const activity = document.getElementById("filterActivity").value;
    const qty = document.getElementById("filterQty").value;

    const term = searchTerm.toLowerCase();

    const filtered = allStations.filter(station => {
      if (city && station.city !== city) return false;
      if (state && station.state !== state) return false;

      if (subsystem || activity || qty) {
        if (!station.subsystems) return false;
        const ok = station.subsystems.some(s => {
          if (subsystem && s.sysType !== subsystem) return false;
          if (activity && s.currentActivity !== activity) return false;
          if (qty && getQtyLevel(s) !== qty) return false;
          return true;
        });
        if (!ok) return false;
      }

      if (!term) return true;

      if (station.stationID.toLowerCase().includes(term)) return true;
      if (station.pincode?.toString().includes(term)) return true;

      if (station.manager) {
        const mn = (station.manager.F_name + " " + station.manager.L_name).toLowerCase();
        if (mn.includes(term)) return true;
      }

      if (station.staff) {
        return station.staff.some(s =>
                (s.F_name + " " + s.L_name).toLowerCase().includes(term)
        );
      }

      return false;
    });

    displayStations(filtered);
  }

  // update activity dropdown
  document.getElementById("filterSubsystem").addEventListener("change", function () {
    const sub = this.value;
    const statusSel = document.getElementById("filterActivity");
    statusSel.innerHTML = '<option value="">Status</option>';

    if (sub && subsystemActivities[sub]) {
      subsystemActivities[sub].forEach(a => {
        const opt = document.createElement("option");
        opt.value = a;
        opt.text = a;
        statusSel.appendChild(opt);
      });
    }
    applyFilters(document.getElementById("searchInput").value);
  });

  ["filterCity", "filterState", "filterActivity", "filterQty"].forEach(id =>
          document.getElementById(id).addEventListener("change", () =>
                  applyFilters(document.getElementById("searchInput").value)
          )
  );

  // Search button
  document.getElementById("searchBtn").addEventListener("click", () => {
    const term = document.getElementById("searchInput").value.trim();
    logToConsole(`> SEARCH triggered for: "${term}"`);
    applyFilters(term);
  });

  // Enter key search
  document.getElementById("searchInput").addEventListener("keypress", e => {
    if (e.key === "Enter") {
      const term = document.getElementById("searchInput").value.trim();
      logToConsole(`> SEARCH triggered for: "${term}"`);
      applyFilters(term);
    }
  });

  document.addEventListener("DOMContentLoaded", async () => {
    await loadStations();
    await loadAggregations();
    await loadTopAvgResource();
  });
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js" integrity="sha512-jGsMH83oKe9asCpkOVkBnUrDDTp8wl+adkB2D+//JtlxO4SrLoJdhbOysIFQJloQFD+C4Fl1rMsQZF76JjV0eQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.2/imagesloaded.pkgd.min.js" integrity="sha512-iHzEu7GbSc705hE2skyH6/AlTpOfBmkx7nUqTLGzPYR+C1tRaItbRlJ7hT/D3YQ9SV0fqLKzp4XY9wKulTBGTw==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/TweenMax.min.js" integrity="sha512-Z5heTz36xTemt1TbtbfXtTq5lMfYnOkXM2/eWcTTiLU01+Sw4ku1i7vScDc8fWhrP2abz9GQzgKH5NGBLoYlAw==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.1/plugins/ScrollToPlugin.min.js" integrity="sha512-CDeU7pRtkPX6XJtF/gcFWlEwyaX7mcAp5sO3VIu/ylsdR74wEw4wmBpD5yYTrmMAiAboi9thyBUr1vXRPA7t0Q==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha512-iztkobsvnjKfAtTNdHkGVjAYTrrtlC7mGp/54c40wowO7LhURYl3gVzzcEqGl/qKXQltJ2HwMrdLcNUdo+N/RQ==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.4/isotope.pkgd.min.js" integrity="sha512-VDBOIlDbuC4VWxGJNmuFRQ0Li0SKkDpmGyuhAG5LTDLd/dJ/S0WMVxriR2Y+CyPL5gzjpN4f/6iqWVBJlht0tQ==" crossorigin="anonymous"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
<script src="/js/hugo-academic.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
